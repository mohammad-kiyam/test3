<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Friends</title>
</head>
<body>
    {% include 'partials/nav.html' %}
    {% include 'partials/flash.html' %}
    <h1>Friends</h1>

    <!-- Send Friend Request -->
    <div>
        <h2>Send Friend Request</h2>
        <form action="/friends" method="POST">
            <input type="email" name="email" placeholder="Enter friend's email" required>
            <button type="submit">Send Request</button>
        </form>
    </div>

    <!-- Friends List Dropdown -->
    <div>
        <h2>Friends</h2>
        <div>
            <button id="friends-list-toggle">Your Friends</button>
            <ul id="friends-list" style="display: none;">
                <!-- Friends list will be dynamically loaded here -->
            </ul>
        </div>
    </div>

    <!-- Pending Friend Requests Dropdown -->
    <div>
        <h2>Pending Friend Requests</h2>
        <div>
            <button id="pending-requests-toggle">Pending Requests</button>
            <ul id="pending-requests" style="display: none;">
                <!-- Pending friend requests will be dynamically loaded here -->
            </ul>
        </div>
    </div>

    <script>
        document.getElementById('friends-list-toggle').addEventListener('click', () => {
            const friendsList = document.getElementById('friends-list');
            if (friendsList.style.display === 'none') {
                fetch('/api/friends_list')
                    .then(response => response.json())
                    .then(data => {
                        friendsList.innerHTML = '';
                        if (data.friends.length > 0) {
                            data.friends.forEach(friend => {
                                const li = document.createElement('li');
                                li.textContent = friend;
                                friendsList.appendChild(li);
                            });
                        } else {
                            friendsList.innerHTML = '<li>You have no friends yet.</li>';
                        }
                        friendsList.style.display = 'block';
                    })
                    .catch(error => {
                        console.error('Error fetching friends list:', error);
                    });
            } else {
                friendsList.style.display = 'none';
            }
        });

        document.getElementById('pending-requests-toggle').addEventListener('click', () => {
            const pendingRequests = document.getElementById('pending-requests');
            if (pendingRequests.style.display === 'none') {
                fetch('/api/pending_requests')
                    .then(response => response.json())
                    .then(data => {
                        pendingRequests.innerHTML = '';
                        if (data.requests.length > 0) {
                            data.requests.forEach(request => {
                                const li = document.createElement('li');
                                li.textContent = request.email;
                                pendingRequests.appendChild(li);
                            });
                        } else {
                            pendingRequests.innerHTML = '<li>No pending friend requests.</li>';
                        }
                        pendingRequests.style.display = 'block';
                    })
                    .catch(error => {
                        console.error('Error fetching pending requests:', error);
                    });
            } else {
                pendingRequests.style.display = 'none';
            }
        });
    </script>
</body>
</html>
